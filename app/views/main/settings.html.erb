<% provide(:in_board, true) -%>
<% provide(:board_name, "_SETTINGS") -%>
<div class=settings_page>
    <div class=section>
        <input id=showhide_profile type=checkbox class=showhider checked />
        <label for=showhide_profile>
            <span class=section_heading>Profile</span>
        </label>
        <div class=section_content>
            <%= form_tag '/configure/profile', class: 'profile_form' do %>
                <input type=hidden name=id value="<%= @user.id %>" />
                <div>
                    <label for=email>Email address:</label>
                    <input type=text name=email value="<%= @user.email %>" />
                </div>
                <div>
                    <label for=name>Visible name:</label>
                    <input type=text name=name value="<%= @user.name %>" />
                </div>
                <button class=change_button type=submit>Change</button>
            <% end -%>
        </div>
    </div>
<% if @user.can_confirm_users or @user.can_edit_users -%>
    <div class=section>
        <% if @unconfirmed_users.length > 0 -%>
        <input id=showhide_requests type=checkbox class=showhider checked />
        <label for=showhide_requests>
            <span class=section_heading>Invitation Requests</span>
        </label>
        <div class=section_content>
            <div class="request_row user_header">
                <div class=user_id>ID</div>
                <div class=user_email>email</div>
                <div class=user_name>name</div>
            </div>
            <% for u in @unconfirmed_users -%>
            <%= form_tag '/configure/confirm' do %>
            <div class=request_row>
                <div class=user_id><%=u.id%></div>
                    <input type=hidden name=id value="<%=u.id%>"/>
                <div class=user_email><%=u.email%></div>
                <div class=user_name><%=u.name%></div>
                <button name=do value=confirm>Confirm</button>
                <button name=do value=deny>Deny</button>
            </div>
            <% end -%>
            <% end -%>
        </div>
        <% else -%>
        <div class=section_heading>No Invitation Requests</div>
    <% end -%>
    </div>
<% end -%>
<% if @user.can_edit_boards -%>
    <div class=section>
        <input id=showhide_boards type=checkbox class=showhider />
        <label for=showhide_boards>
            <span class=section_heading>Edit Boards</span>
        </label>
        <div class=section_content>
            <div class="board_row boards_header">
                <div class=board_id>ID</div>
                <div class=board_name>Name</div>
                <div class=board_order>Order</div>
                <div class=board_ppp>Posts/Page</div>
            </div>
            <% for b in @boards -%>
            <%= form_tag '/configure/change_board' do %>
            <div class=board_row>
                <div class=board_id><%=b.id%>
                    <input type=hidden name=id value="<%=b.id%>"/>
                </div>
                <div class=board_name>
                    <input type=text name=name value="<%=b.name%>"/>
                </div>
                <div class=board_order>
                    <input type=number name=order value="<%=b.order%>"/>
                </div>
                <div class=board_ppp>
                    <input type=number name=ppp value="<%=b.ppp%>"/>
                </div>
                <button name=do value=change>Change</button>
            </div>
            <% end -%>
            <% end -%>
            <%= form_tag '/board/new_board' do %>
            <div class=board_row>
                <div class=board_id>New</div>
                <div class=board_name>
                    <input type=text name=name />
                </div>
                <div class=board_order>
                    <input type-number name=order value="0.0"/>
                </div>
                <button type=submit>Create</button>
            </div>
            <% end -%>
            <div class=section_sub_heading>Default boards</div>
            <% settings = SiteSettings.first_or_create -%>
            <%= form_tag '/configure/default_boards', class: 'default_boards_form' do %>
            <div>
                <label for=initial_board>After logging in, go to</label>
                <select id=initial_board name=initial_board>
                <% for b in @boards -%>
                    <option value="<%=b.id%>" <%= settings.initial_board == b.id ? 'selected' : ''%>><%=b.name%></option>
                <% end -%>
                </select>
            </div>
            <div>
                <label for=sitewide_event_board>Send site-wide events to</label>
                <select id=sitewide_event_board name=sitewide_event_board>
                <% for b in @boards -%>
                    <option value="<%=b.id%>" <%= settings.sitewide_event_board == b.id ? 'selected' : ''%>><%=b.name%></option>
                <% end -%>
                </select>
            </div>
            <button type=submit class=change_button>Change</button>
            <% end -%>
        </div>
    </div>
<% end -%>
<% if @user.can_change_site_settings -%>
    <% settings = SiteSettings.first_or_create -%>
    <div class=section>
        <input id=showhide_mail type=checkbox class=showhider />
        <label for=showhide_mail>
            <span class=section_heading>Mail Configuration</span>
        </label>
        <div class=section_content>
        <%= form_tag '/configure/mail', class: 'configure_mail_form' do %>
            <div>
                <label for=enable_mail>Enable Mailing Posts</label>
                <input type=checkbox id=enable_mail name=enable_mail <%=settings.enable_mail ? 'checked' : ''%> />
            </div>
            <div>
                <label for=smtp_server>SMTP Server:</label>
                <input type=text id=smtp_server name=smtp_server value="<%=settings.smtp_server || ''%>" />
            </div>
            <div>
                <label for=smtp_port>Port:</label>
                <input type=number id=smtp_port name=smtp_port value="<%=settings.smtp_port || ''%>" />
            </div>
            <div>
                <label for=smtp_auth>Authentication Method:</label>
                <select id=smtp_auth name=smtp_auth>
                    <option value=plain <%=settings.smtp_auth == 'plain' ? 'selected' : ''%> />plain</option>
                    <option value=login <%=settings.smtp_auth == 'login' ? 'selected' : ''%> />login</option>
                    <option value=cram_md5 <%=settings.smtp_auth == 'cram_md5' ? 'selected' : ''%> />cram_md5</option>
                </select>
            </div>
            <div>
                <label for=smtp_username>Username:</label>
                <input type=text id=smtp_username name=smtp_username value="<%=settings.smtp_username || ''%>" />
            </div>
            <div>
                <label for=smtp_password>Password:</label>
                <input type=password id=smtp_password name=smtp_password value="<%=settings.smtp_password || ''%>" />
            </div>
            <div>
                <label for=smtp_starttls_auto>Enable StartTLS Auto:</label>
                <input type=checkbox id=smtp_starttls_auto name=smtp_starttls_auto <%=settings.smtp_starttls_auto ? 'checked' : ''%> />
            </div>
            <div> 
                <label for=smtp_ssl_verify>OpenSSL Verify Mode:</label>
                <select id=smtp_ssl_verify name=smtp_ssl_verify>
                    <option value=none <%=settings.smtp_ssl_verify == 'none' ? 'selected' : ''%> />none</option>
                    <option value=peer <%=settings.smtp_ssl_verify == 'peer' ? 'selected' : ''%> />peer</option>
                    <option value=client_once <%=settings.smtp_ssl_verify == 'client_once' ? 'selected' : ''%> />client_once</option>
                    <option value=fail_if_no_peer_cert <%=settings.smtp_ssl_verify == 'fail_if_no_peer_cert' ? 'selected' : ''%> />fail_if_no_peer_cert</option>
                </select>
            </div>
            <button class=change_button type=submit>Change</button>
            <div>
                <label for=send_test_to>Send test mail to:</label>
                <input type=text id=send_test_to name=send_test_to value="<%=settings.send_test_to%>" />
                <button name=do value=send_test>Send</button>
            </div>
        <% end -%>
        </div>
    </div>
<% end -%>
<% if @user.can_edit_users -%>
    <div class=section>
        <input id=showhide_users type=checkbox class=showhider />
        <label for=showhide_users>
            <span class=section_heading>Manage Users</span>
        </label>
        <div class=section_content>
        <div class=user_table>
        <div class=user_header>
            <!-- Have to match that silly Rails hidden input div -->
            <div style="margin:0;padding:0;display:inline"></div>
            <div>ID</div>
            <div>Name</div>
            <div>Email</div>
            <div>A</div>
            <div>B</div>
            <div>C</div>
            <div>D</div>
            <div>E</div>
            <div>F</div>
            <div></div>
            <div></div>
        </div>
        <% for u in User.all -%>
        <%= form_tag '/configure/user', class: 'user_row' do -%>
            <div>
                <%=u.id%>
                <input type=hidden name=id value="<%=u.id%>"/>
            </div>
            <div>
                <input type=text name=name value="<%=u.name%>"/>
            </div>
            <div>
                <input type=text name=email value="<%=u.email%>"/>
            </div>
            <div>
                <input type=checkbox name=can_mail_posts <%=u.can_mail_posts != false ? 'checked' : ''%> />
            </div>
            <div>
                <input type=checkbox name=can_confirm_users <%=u.can_confirm_users ? 'checked' : ''%> />
            </div>
            <div>
                <input type=checkbox name=can_change_appearance <%=u.can_change_appearance ? 'checked' : ''%> />
            </div>
            <div>
                <input type=checkbox name=can_edit_boards <%=u.can_edit_boards ? 'checked' : ''%> />
            </div>
            <div>
                <input type=checkbox name=can_edit_users <%=u.can_edit_users ? 'checked' : ''%> />
            </div>
            <div>
                <input type=checkbox name=can_change_site_settings <%=u.can_change_site_settings ? 'checked' : ''%> />
            </div>
            <div>
                <button name=do value=change>Change</button>
            </div>
            <div>
                <button name=do value=remove>Remove</button>
            </div>
        <% end -%>
        <% end -%>
        </div>
    </div>
<% end -%>
</div>