<% provide(:in_board, true) -%>
<% provide(:board_name, "_SETTINGS") -%>
<div class=settings_page>
    <div class=section>
    <div class=section_heading>Profile</div>
        <%= form_tag '/user/edit', action: 'POST', class: 'profile_form' do %>
            <input type=hidden name=id value="<%= @user.id %>" />
            <div>
                <label for=email>Email address:</label>
                <input type=text name=email value="<%= @user.email %>" />
            </div>
            <div>
                <label for=name>Visible name:</label>
                <input type=text name=name value="<%= @user.name %>" />
            </div>
            <button type=submit>Change</button>
        <% end -%>
    </div>
<% if @user.can_edit_boards -%>
    <div class=section>
        <div class=section_heading>Boards</div>
        <div class="board_row boards_header">
            <div class=board_id>ID</div>
            <div class=board_name>Name</div>
        </div>
        <% for t in @boards -%>
        <%= form_tag '/board/edit',  action: 'POST' do %>
        <div class=board_row>
            <div class=board_id><%=t.id%>
                <input type=hidden name=id value="<%=t.id%>"/>
            </div>
            <div class=board_name>
                <input type=text name=name value="<%=t.name%>"/>
            </div>
            <div class=board_order>
                <input type=number name=order value="<%=t.order%>"/>
            </div>
            <button name=do value=change>Change</button>
            <button name=do value=delete>Delete</button>
        </div>
        <% end -%>
        <% end -%>
        <%= form_tag '/board/new', action: 'POST' do %>
        <div class=board_row>
            <div class=board_id>New</div>
            <div class=board_name>
                <input type=text name=name />
            </div>
            <div class=board_order>
                <input type-number name=order value="0.0"/>
            </div>
            <button type=submit>Create</button>
        </div>
        <% end -%>
    </div>
<% end -%>
<% if @user.can_confirm_users or @user.can_edit_users -%>
    <div class=section>
    <% if @unconfirmed_users.length > 0 -%>
        <div class=section_heading>Invitation Requests</div>
        <div class="user_row user_header">
            <div class=user_id>ID</div>
            <div class=user_email>email</div>
            <div class=user_name>name</div>
        </div>
        <% for u in @unconfirmed_users -%>
        <%= form_tag '/user/confirm', action: 'POST' do %>
        <div class=user_row>
            <div class=user_id><%=u.id%></div>
                <input type=hidden name=id value="<%=u.id%>"/>
            <div class=user_email><%=u.email%></div>
            <div class=user_name><%=u.name%></div>
            <button name=do value=confirm>Confirm</button>
            <button name=do value=deny>Deny</button>
        </div>
        <% end -%>
        <% end -%>
    <% else -%>
        <div class=section_heading>No Invitation Requests</div>
    <% end -%>
    </div>
<% end -%>
<% if @user.can_change_site_settings -%>
    <div class=section>
    <div class=section_heading>Site settings</div>
        <%= form_tag '/main/change_settings', class: 'site_settings_form' do %>
            <div>
                <label for=frobnicate>Frobnicate Widgets</label>
                <input type=checkbox id=frobnicate name=frobnicate <%=SiteSettings.settings['frobnicate'] ? 'checked' : ''%> />
            </div>
            <div>
                <label for=enable_mail>Enable Mailing Posts</label>
                <input type=checkbox id=enable_mail name=enable_mail <%=SiteSettings.settings['enable_mail'] ? 'checked' : ''%> />
            </div>
            <div class=section>
            <div class=section_heading>SMTP Settings</div>
                <div>
                    <label for=smtp_server>Server:</label>
                    <input type=text id=smtp_server name=smtp_server value="<%=SiteSettings.settings['smtp_server'] || ''%>" />
                </div>
                <div>
                    <label for=smtp_port>Port:</label>
                    <input type=text id=smtp_port name=smtp_port value="<%=SiteSettings.settings['smtp_server'] || ''%>" />
                </div>
                <div>
                    <label for=smtp_auth>Authentication Method:</label>
                    <select id=smtp_auth>
                        <option value=plain <%=SiteSettings.settings['smtp_auth'] == 'plain' ? 'selected' : ''%> />plain</option>
                        <option value=login <%=SiteSettings.settings['smtp_auth'] == 'login' ? 'selected' : ''%> />login</option>
                        <option value=cram_md5 <%=SiteSettings.settings['smtp_auth'] == 'cram_md5' ? 'selected' : ''%> />cram_md5</option>
                    </select>
                </div>
                <div>
                    <label for=smtp_username>Username:</label>
                    <input type=text id=smtp_username name=smtp_username value="<%=SiteSettings.settings['smtp_username'] || ''%>" />
                </div>
                <div>
                    <label for=smtp_password>Password:</label>
                    <input type=password id=smtp_password name=smtp_password value="<%=SiteSettings.settings['smtp_password'] || ''%>" />
                </div>
                <div>
                    <label for=smtp_starttls_auto>Enable StartTLS Auto:</label>
                    <input type=checkbox id=smtp_starttls_auto name=smtp_password value="<%=SiteSettings.settings['smtp_password'] || ''%>" />
                </div>
                <div> 
                    <label for=smtp_ssl_verify>OpenSSL Verify Mode:</label>
                    <select id=smtp_ssl_verify>
                        <option value=none <%=SiteSettings.settings['smtp_ssl_verify'] == 'none' ? 'selected' : ''%> />none</option>
                        <option value=peer <%=SiteSettings.settings['smtp_ssl_verify'] == 'peer' ? 'selected' : ''%> />peer</option>
                        <option value=client_once <%=SiteSettings.settings['smtp_ssl_verify'] == 'client_once' ? 'selected' : ''%> />client_once</option>
                        <option value=fail_if_no_peer_cert <%=SiteSettings.settings['smtp_ssl_verify'] == 'fail_if_no_peer_cert' ? 'selected' : ''%> />fail_if_no_peer_cert</option>
                    </select>
                </div>
            </div>
            <button type=submit>Change</button>
        <% end -%>
    </div>
<% end -%>
</div>
